{
  // 日志配置
  "log": {
    "loglevel": "warning" // 设置日志级别为警告级别
  },
  
  // 启用流量统计功能
  "stats": {},
  
  // 启用管理API接口
  "api": {
    "tag": "api",
    "services": ["StatsService"] // 提供统计数据API服务
  },
  
  // 配置本地策略和流量控制
  "policy": {
    "levels": {
      "0": { // 配置用户级别0的连接策略
        "handshake": 5, // 设置握手超时时间为5秒
        "connIdle": 300, // 设置连接空闲超时时间为300秒
        "uplinkOnly": 2, // 设置仅上行连接超时时间为2秒
        "downlinkOnly": 3, // 设置仅下行连接超时时间为3秒
        "statsUserUplink": true, // 启用用户上行流量统计
        "statsUserDownlink": true, // 启用用户下行流量统计
        "bufferSize": 512 // 设置缓冲区大小为512KB
      }
    },
    "system": {
      "statsInboundUplink": true, // 启用入站上行流量统计
      "statsInboundDownlink": true, // 启用入站下行流量统计
      "statsOutboundUplink": true, // 启用出站上行流量统计
      "statsOutboundDownlink": true // 启用出站下行流量统计
    }
  },
  
  // 配置入站连接处理器
  "inbounds": [
    {
      // 配置虚拟DNS服务入站
      "tag": "dns-in",
      "port": 10853, // 监听端口10853
      "listen": "127.0.0.1", // 绑定本地回环地址
      "protocol": "dokodemo-door", // 使用任意门协议
      "settings": {
        "address": "8.8.8.8", // 转发到Google DNS
        "port": 53, // 目标端口53
        "network": "tcp,udp" // 支持TCP和UDP协议
      }
    },
    {
      // 配置SOCKS5代理入站
      "tag": "socks",
      "port": 7898, // 监听端口7898
      "listen": "127.0.0.1", // 绑定本地回环地址
      "protocol": "socks", // 使用SOCKS协议
      "settings": {
        "auth": "noauth", // 无需身份验证
        "udp": true // 启用UDP支持
      },
      "sniffing": {
        "enabled": true, // 启用流量嗅探
        "destOverride": ["http", "tls"], // 嗅探HTTP和TLS流量
        "routeOnly": false // 允许修改目标地址
      }
    },
    {
      // 配置HTTP代理入站
      "tag": "http",
      "port": 7899, // 监听端口7899
      "protocol": "http", // 使用HTTP协议
      "sniffing": {
        "enabled": true, // 启用流量嗅探
        "destOverride": ["http", "tls"], // 嗅探HTTP和TLS流量
        "routeOnly": true // 仅用于路由判断不修改目标
      },
      "settings": {
        "auth": "noauth", // 无需身份验证
        "udp": true, // 启用UDP支持
        "allowTransparent": false // 禁用透明代理模式
      }
    },
    {
      // 配置API管理接口入站
      "tag": "api",
      "port": 10085, // 监听端口10085
      "listen": "127.0.0.1", // 绑定本地回环地址
      "protocol": "dokodemo-door", // 使用任意门协议
      "settings": {
        "address": "127.0.0.1" // 转发到本地地址
      }
    }
  ],

  // 配置出站连接处理器
  "outbounds": [
    {
      // 配置DNS查询出站
      "tag": "dns-out",
      "protocol": "dns" // 使用DNS协议
    },
    {
      // 配置代理服务器出站
      "tag": "proxy",
      "protocol": "vless", // 使用VLESS协议
      "settings": {
        "vnext": [
          {
            "address": "SERVER_IP", // 代理服务器地址(运行时替换)
            "port": 80, // 连接端口80
            "users": [
              {
                "id": "bc24baea-3e5c-4107-a231-416cf00504fe", // 用户UUID
                "alterId": 0, // 额外ID数量
                "email": "t@t.tt", // 用户邮箱标识
                "security": "auto", // 自动安全设置
                "encryption": "none" // 不使用加密
              }
            ]
          }
        ]
      },
      "streamSettings": {
        "network": "ws", // 使用WebSocket传输
        "security": "", // 无传输层安全
        "wsSettings": {
          "path": "/?ed=2560", // WebSocket路径
          "headers": {
            "Host": "pagesvless.jeseelim.workers.dev" // 设置Host头
          }
        },
        "tlsSettings": {
          "serverName": "pagesvless.jeseelim.workers.dev", // TLS服务器名称
          "allowInsecure": false, // 禁止不安全连接
          "alpn": ["http/1.1"], // 应用层协议协商
          "fingerprint": "chrome" // 使用Chrome指纹
        }
      },
      "mux": {
        "enabled": false, // 禁用多路复用
        "concurrency": -1 // 并发连接数无限制
      }
    },
    {
      // 配置直连出站
      "tag": "direct",
      "protocol": "freedom", // 使用直连协议
      "settings": {} // 使用默认设置
    },
    {
      // 配置阻断出站
      "tag": "block",
      "protocol": "blackhole", // 使用黑洞协议
      "settings": {
        "response": {
          "type": "http" // 返回HTTP响应
        }
      }
    }
  ],

  // 配置DNS解析服务
  "dns": {
    "hosts": { // 配置静态DNS映射表(提升解析速度和稳定性)
      "dns.google": "8.8.8.8", // Google DNS主服务器地址映射
      "dns.cloudflare.com": "1.1.1.1", // Cloudflare DNS主服务器地址映射
      "cloudflare-dns.com": "1.1.1.1", // Cloudflare DNS备用域名地址映射
      "one.one.one.one": "1.1.1.1", // Cloudflare DNS易记域名映射
      "dns.quad9.net": "9.9.9.9", // Quad9 DNS服务器映射
      "dns.adguard.com": "94.140.14.14", // AdGuard DNS服务器映射
      "dns.cleanwebproxy.com": "185.228.168.9", // CleanBrowsing DNS映射
      "localhost": "127.0.0.1", // 本地回环地址映射
      "ip6-localhost": "::1", // IPv6本地回环地址映射
      "broadcasthost": "255.255.255.255" // 网络广播地址映射
    },
    "servers": [
      {
        // 配置中国大陆域名DNS服务器(阿里DNS)
        "address": "223.5.5.5", // 阿里DNS主服务器
        "domains": [
          "geosite:cn", // 中国大陆网站域名
          "geosite:geolocation-cn" // 中国大陆地理位置域名
        ],
        "expectIPs": ["geoip:cn"], // 期望返回中国IP段
        "skipFallback": true // 跳过备用DNS查询
      },
      {
        // 配置备用服务器
        "address": "114.114.114.114", // DNS备用服务器
        "domains": [
          "geosite:cn",
          "geosite:geolocation-cn"
        ],
        "expectIPs": ["geoip:cn"],
        "skipFallback": true
      },
      "1.1.1.1", // Cloudflare DNS
      "8.8.8.8", // Google DNS
      "9.9.9.9"  // Quad9 DNS
    ],
    "disableCache": true, // 启用DNS缓存机制
    "disableFallback": true // 启用DNS备用查询
  },
  
  // 配置流量路由规则
  "routing": {
    "domainStrategy": "AsIs", // 使用域名原始格式进行路由
    "rules": [
      {
        // 路由API管理流量到API出站
        "type": "field",
        "inboundTag": ["api"], // 匹配API入站标签
        "outboundTag": "api" // 转发到API出站
      },
      {
        // 路由DNS查询流量到DNS出站
        "type": "field",
        "inboundTag": ["dns-in"], // 匹配DNS入站标签
        "outboundTag": "dns-out" // 转发到DNS出站
      },
      {
        // 路由代理入站的DNS查询到DNS出站
        "type": "field",
        "inboundTag": ["socks", "http"], // 匹配SOCKS和HTTP入站
        "port": 53, // 匹配端口53
        "network": "tcp,udp", // 匹配TCP和UDP协议
        "outboundTag": "dns-out" // 转发到DNS出站
      },
      {
        // 路由国外DNS查询到代理出站
        "type": "field",
        "outboundTag": "proxy", // 转发到代理出站
        "port": 53, // 匹配端口53
        "ip": ["1.1.1.1", "8.8.8.8"] // 匹配Cloudflare和Google DNS
      },
      {
        // 路由国内DNS查询到直连出站
        "type": "field",
        "outboundTag": "direct", // 转发到直连出站
        "port": 53, // 匹配端口53
        "ip": ["223.5.5.5"] // 匹配阿里DNS
      },
      {
        // 路由NTP时间同步流量到直连出站
        "type": "field",
        "outboundTag": "direct", // 转发到直连出站
        "port": 123, // 匹配NTP端口123
        "network": "udp" // 匹配UDP协议
      },
      {
        // 路由BT下载流量到直连出站
        "type": "field",
        "outboundTag": "direct", // 转发到直连出站
        "protocol": ["bittorrent"] // 匹配BT协议
      },
      {
        // 路由中国大陆域名到直连出站
        "type": "field",
        "outboundTag": "direct", // 转发到直连出站
        "domain": ["geosite:cn"] // 匹配中国大陆域名
      },
      {
        // 路由私有网络和中国IP到直连出站
        "type": "field",
        "outboundTag": "direct", // 转发到直连出站
        "ip": ["geoip:private", "geoip:cn"] // 匹配私有和中国IP
      },
      {
        // 阻断广告域名流量
        "type": "field",
        "outboundTag": "block", // 转发到阻断出站
        "domain": ["geosite:category-ads-all"] // 匹配所有广告域名
      },
      {
        // 路由其他所有流量到代理出站
        "type": "field",
        "network": "tcp,udp", // 匹配TCP和UDP协议
        "outboundTag": "proxy" // 转发到代理出站
      }
    ]
  }
}
