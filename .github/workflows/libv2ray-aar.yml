name: Complete libv2ray.aar Analysis
on:
  workflow_dispatch:

jobs:
  analyze:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    
    - name: Setup Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'
    
    - name: Install analysis tools
      run: |
        # å®‰è£… jadx (æœ€æ–°ç‰ˆæœ¬)
        echo "Installing JADX..."
        wget -q https://github.com/skylot/jadx/releases/download/v1.4.7/jadx-1.4.7.zip
        unzip -q jadx-1.4.7.zip -d jadx
        chmod +x jadx/bin/jadx
        echo "âœ“ JADX installed"
        
        # å®‰è£… cfr (å¦ä¸€ä¸ªä¼˜ç§€çš„åç¼–è¯‘å™¨)
        echo "Installing CFR..."
        wget -q https://github.com/leibnitz27/cfr/releases/download/0.152/cfr-0.152.jar -O cfr.jar
        echo "âœ“ CFR installed"
        
        # å®‰è£… procyon (å¤‡é€‰åç¼–è¯‘å™¨)
        echo "Installing Procyon..."
        wget -q https://github.com/mstrobel/procyon/releases/download/v0.6.0/procyon-decompiler-0.6.0.jar -O procyon.jar
        echo "âœ“ Procyon installed"
    
    - name: Basic AAR Information
      run: |
        echo "================================================"
        echo "           AAR File Basic Information"
        echo "================================================"
        
        # æ–‡ä»¶ä¿¡æ¯
        echo -e "\nðŸ“ FILE INFO:"
        ls -lh android/app/libs/libv2ray.aar
        file android/app/libs/libv2ray.aar
        md5sum android/app/libs/libv2ray.aar
        
        # è§£åŽ‹ AAR
        mkdir -p /tmp/aar_analysis
        cp android/app/libs/libv2ray.aar /tmp/aar_analysis/
        cd /tmp/aar_analysis
        unzip -q libv2ray.aar
        
        echo -e "\nðŸ“¦ AAR CONTENTS:"
        ls -la
        
        echo -e "\nðŸŒ³ FILE STRUCTURE:"
        tree -h 2>/dev/null || find . -type f | sort | while read f; do
          size=$(ls -lh "$f" | awk '{print $5}')
          echo "  $f ($size)"
        done
    
    - name: Extract and Prepare classes.jar
      run: |
        cd /tmp/aar_analysis
        
        echo "================================================"
        echo "           Extracting classes.jar"
        echo "================================================"
        
        # è§£åŽ‹ classes.jar
        mkdir -p extracted_classes
        cd extracted_classes
        jar xf ../classes.jar
        
        echo -e "\nðŸ“‹ ALL CLASSES:"
        find . -name "*.class" | sort | while read class; do
          size=$(ls -l "$class" | awk '{print $5}')
          echo "  $class (${size} bytes)"
        done
        
        echo -e "\nðŸ“¦ PACKAGE STRUCTURE:"
        find . -name "*.class" | sed 's|^\./||' | sed 's|/[^/]*\.class$||' | sort | uniq | while read pkg; do
          count=$(find "./$pkg" -maxdepth 1 -name "*.class" 2>/dev/null | wc -l)
          echo "  ðŸ“ $pkg ($count classes)"
        done
    
    - name: Complete javap Analysis (All Access Levels)
      run: |
        cd /tmp/aar_analysis/extracted_classes
        
        echo "================================================"
        echo "    Complete javap Analysis (All Members)"
        echo "================================================"
        
        # åˆ†æžæ¯ä¸ªç±»
        for class_file in $(find . -name "*.class" | sort); do
          class_name=$(echo $class_file | sed 's|^\./||' | sed 's|\.class$||' | sed 's|/|.|g')
          
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ðŸ” CLASS: $class_name"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          
          # åŸºæœ¬ä¿¡æ¯
          echo -e "\nðŸ“Š CLASS INFO:"
          javap -cp . "$class_name" 2>/dev/null | head -5 || echo "Failed to analyze"
          
          # æ‰€æœ‰å­—æ®µï¼ˆåŒ…æ‹¬ç§æœ‰ï¼‰
          echo -e "\nðŸ“Œ ALL FIELDS:"
          javap -p -cp . "$class_name" 2>/dev/null | grep -E "^\s+(public|protected|private|static|final).*;" | while read line; do
            echo "    $line"
          done || echo "    No fields found"
          
          # æ‰€æœ‰æ–¹æ³•ï¼ˆåŒ…æ‹¬ç§æœ‰ï¼‰
          echo -e "\nðŸ”§ ALL METHODS:"
          javap -p -cp . "$class_name" 2>/dev/null | grep -E "^\s+(public|protected|private|static|final|synchronized|native|abstract).*\(" | while read line; do
            echo "    $line"
          done || echo "    No methods found"
          
          # Native æ–¹æ³•ç‰¹åˆ«æ ‡è®°
          native_methods=$(javap -p -cp . "$class_name" 2>/dev/null | grep "native" || true)
          if [ ! -z "$native_methods" ]; then
            echo -e "\nâš¡ NATIVE METHODS:"
            echo "$native_methods" | while read line; do
              echo "    $line"
            done
          fi
        done
    
    - name: JADX Deep Decompilation
      run: |
        cd /tmp/aar_analysis
        
        echo "================================================"
        echo "          JADX Decompilation"
        echo "================================================"
        
        # ä½¿ç”¨ jadx åç¼–è¯‘
        $GITHUB_WORKSPACE/jadx/bin/jadx \
          --show-bad-code \
          --no-res \
          --deobf \
          --comments-level error \
          --log-level ERROR \
          -d decompiled_jadx \
          classes.jar 2>/dev/null || true
        
        echo -e "\nðŸ“ DECOMPILED JAVA FILES:"
        find decompiled_jadx -name "*.java" 2>/dev/null | sort || echo "No files found"
        
        echo -e "\n================================================"
        echo "          Complete Source Code (JADX)"
        echo "================================================"
        
        # æ˜¾ç¤ºæ‰€æœ‰åç¼–è¯‘çš„æºä»£ç 
        for java_file in $(find decompiled_jadx -name "*.java" 2>/dev/null | sort); do
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ðŸ“„ FILE: $(echo $java_file | sed 's|decompiled_jadx/||')"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          cat "$java_file"
        done || echo "No source files to display"
        
        # ðŸ†• åˆå¹¶æ‰€æœ‰JADXåç¼–è¯‘æ–‡ä»¶åˆ°å•ä¸€æ–‡ä»¶
        echo -e "\n================================================"
        echo "      ðŸ”„ åˆå¹¶JADXåç¼–è¯‘æ–‡ä»¶ä¸ºå•ä¸€æ–‡ä»¶"
        echo "================================================"
        
        # åˆ›å»ºåˆå¹¶æ–‡ä»¶
        cat > JADX_ALL_SOURCES.java << 'EOF'
/*
 * =================================================================
 *               JADX åç¼–è¯‘å®Œæ•´æºç  - åˆå¹¶æ–‡ä»¶
 * =================================================================
 * ç”Ÿæˆæ—¶é—´: $(date)
 * åç¼–è¯‘å·¥å…·: JADX v1.4.7
 * æºæ–‡ä»¶: libv2ray.aar
 * =================================================================
 */

EOF
        
        # åˆå¹¶æ‰€æœ‰Javaæ–‡ä»¶
        file_count=0
        for java_file in $(find decompiled_jadx -name "*.java" 2>/dev/null | sort); do
          relative_path=$(echo $java_file | sed 's|decompiled_jadx/||')
          
          cat >> JADX_ALL_SOURCES.java << EOF

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ðŸ“ æ–‡ä»¶: $relative_path
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

EOF
          cat "$java_file" >> JADX_ALL_SOURCES.java
          echo -e "\n\n" >> JADX_ALL_SOURCES.java
          
          file_count=$((file_count + 1))
        done
        
        echo "âœ… å·²åˆå¹¶ $file_count ä¸ªæ–‡ä»¶åˆ° JADX_ALL_SOURCES.java"
        echo "ðŸ“Š åˆå¹¶æ–‡ä»¶å¤§å°: $(ls -lh JADX_ALL_SOURCES.java | awk '{print $5}')"
    
    - name: CFR Decompilation (Alternative)
      run: |
        cd /tmp/aar_analysis
        
        echo "================================================"
        echo "          CFR Decompilation"
        echo "================================================"
        
        mkdir -p decompiled_cfr
        
        # ä½¿ç”¨ CFR åç¼–è¯‘æ¯ä¸ªç±»
        for class_file in $(find extracted_classes -name "*.class" | grep -E "libv2ray|go/Seq" | sort); do
          class_name=$(echo $class_file | sed 's|extracted_classes/||' | sed 's|\.class$||' | sed 's|/|.|g')
          output_file="decompiled_cfr/${class_name}.java"
          
          echo "Decompiling: $class_name"
          java -jar $GITHUB_WORKSPACE/cfr.jar "$class_file" > "$output_file" 2>/dev/null || true
        done
        
        echo -e "\nðŸ“ CFR DECOMPILED FILES:"
        find decompiled_cfr -name "*.java" | sort
        
        # æ˜¾ç¤º CFR åç¼–è¯‘ç»“æžœ
        for java_file in $(find decompiled_cfr -name "*.java" | sort); do
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ðŸ“„ CFR: $(basename $java_file)"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          cat "$java_file"
        done
        
        # ðŸ†• åˆå¹¶æ‰€æœ‰CFRåç¼–è¯‘æ–‡ä»¶åˆ°å•ä¸€æ–‡ä»¶
        echo -e "\n================================================"
        echo "      ðŸ”„ åˆå¹¶CFRåç¼–è¯‘æ–‡ä»¶ä¸ºå•ä¸€æ–‡ä»¶"
        echo "================================================"
        
        # åˆ›å»ºCFRåˆå¹¶æ–‡ä»¶
        cat > CFR_ALL_SOURCES.java << 'EOF'
/*
 * =================================================================
 *               CFR åç¼–è¯‘å®Œæ•´æºç  - åˆå¹¶æ–‡ä»¶
 * =================================================================
 * ç”Ÿæˆæ—¶é—´: $(date)
 * åç¼–è¯‘å·¥å…·: CFR v0.152
 * æºæ–‡ä»¶: libv2ray.aar
 * =================================================================
 */

EOF
        
        # åˆå¹¶æ‰€æœ‰CFR Javaæ–‡ä»¶
        cfr_file_count=0
        for java_file in $(find decompiled_cfr -name "*.java" | sort); do
          class_name=$(basename "$java_file" .java)
          
          cat >> CFR_ALL_SOURCES.java << EOF

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ðŸ“ ç±»: $class_name
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

EOF
          cat "$java_file" >> CFR_ALL_SOURCES.java
          echo -e "\n\n" >> CFR_ALL_SOURCES.java
          
          cfr_file_count=$((cfr_file_count + 1))
        done
        
        echo "âœ… å·²åˆå¹¶ $cfr_file_count ä¸ªæ–‡ä»¶åˆ° CFR_ALL_SOURCES.java"
        echo "ðŸ“Š åˆå¹¶æ–‡ä»¶å¤§å°: $(ls -lh CFR_ALL_SOURCES.java | awk '{print $5}')"
    
    # ðŸ†• æ–°å¢žï¼šåˆ›å»ºç»ˆæžåˆå¹¶æ–‡ä»¶
    - name: Create Ultimate Unified Source File
      run: |
        cd /tmp/aar_analysis
        
        echo "================================================"
        echo "    ðŸŽ¯ åˆ›å»ºç»ˆæžç»Ÿä¸€æºç æ–‡ä»¶"
        echo "================================================"
        
        # åˆ›å»ºæœ€ç»ˆçš„è¶…çº§åˆå¹¶æ–‡ä»¶
        cat > ULTIMATE_ALL_SOURCES.java << 'EOF'
/*
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *                          LIBV2RAY.AAR å®Œæ•´åç¼–è¯‘æºç 
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * ðŸ“‹ åˆ†æžä¿¡æ¯:
 *    - æºæ–‡ä»¶: libv2ray.aar
 *    - åˆ†æžæ—¶é—´: $(date)
 *    - åç¼–è¯‘å·¥å…·: JADX v1.4.7 + CFR v0.152
 *    - è¾“å‡ºæ ¼å¼: ç»Ÿä¸€åˆå¹¶æ–‡ä»¶
 * 
 * ðŸ“Š æ–‡ä»¶ç»“æž„:
 *    â”œâ”€ ç¬¬ä¸€éƒ¨åˆ†: JADX åç¼–è¯‘ç»“æžœ (ä¸»è¦)
 *    â”œâ”€ ç¬¬äºŒéƒ¨åˆ†: CFR åç¼–è¯‘ç»“æžœ (å¯¹æ¯”)
 *    â””â”€ ç¬¬ä¸‰éƒ¨åˆ†: æ–¹æ³•æ€»ç»“è¡¨
 * 
 * ðŸ” ä½¿ç”¨è¯´æ˜Ž:
 *    1. æœç´¢ "SECTION 1" æŸ¥çœ‹ JADX åç¼–è¯‘ç»“æžœ
 *    2. æœç´¢ "SECTION 2" æŸ¥çœ‹ CFR åç¼–è¯‘ç»“æžœ  
 *    3. æœç´¢ "SECTION 3" æŸ¥çœ‹æ–¹æ³•æ€»ç»“
 *    4. æœç´¢å…·ä½“ç±»åå¿«é€Ÿå®šä½ä»£ç 
 * 
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

EOF
        
        # ç¬¬ä¸€éƒ¨åˆ†ï¼šJADX ç»“æžœ
        cat >> ULTIMATE_ALL_SOURCES.java << 'EOF'

/*
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *                                  SECTION 1
 *                             JADX åç¼–è¯‘ç»“æžœ (ä¸»è¦)
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

EOF
        
        if [ -f "JADX_ALL_SOURCES.java" ]; then
          # è·³è¿‡JADXæ–‡ä»¶çš„å¤´éƒ¨æ³¨é‡Šï¼Œåªè¦æºç éƒ¨åˆ†
          tail -n +15 JADX_ALL_SOURCES.java >> ULTIMATE_ALL_SOURCES.java
          echo "âœ… JADX å†…å®¹å·²æ·»åŠ "
        else
          echo "// JADX åç¼–è¯‘ç»“æžœæœªæ‰¾åˆ°" >> ULTIMATE_ALL_SOURCES.java
        fi
        
        # ç¬¬äºŒéƒ¨åˆ†ï¼šCFR ç»“æžœ
        cat >> ULTIMATE_ALL_SOURCES.java << 'EOF'

/*
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *                                  SECTION 2
 *                             CFR åç¼–è¯‘ç»“æžœ (å¯¹æ¯”)
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

EOF
        
        if [ -f "CFR_ALL_SOURCES.java" ]; then
          # è·³è¿‡CFRæ–‡ä»¶çš„å¤´éƒ¨æ³¨é‡Šï¼Œåªè¦æºç éƒ¨åˆ†
          tail -n +15 CFR_ALL_SOURCES.java >> ULTIMATE_ALL_SOURCES.java
          echo "âœ… CFR å†…å®¹å·²æ·»åŠ "
        else
          echo "// CFR åç¼–è¯‘ç»“æžœæœªæ‰¾åˆ°" >> ULTIMATE_ALL_SOURCES.java
        fi
        
        # ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ–¹æ³•æ€»ç»“
        cat >> ULTIMATE_ALL_SOURCES.java << 'EOF'

/*
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *                                  SECTION 3
 *                                æ–¹æ³•æ€»ç»“è¡¨
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

/*
EOF
        
        # æ·»åŠ æ–¹æ³•æ€»ç»“ï¼ˆå¦‚æžœå­˜åœ¨ï¼‰
        if [ -f "method_summary.md" ]; then
          cat method_summary.md | sed 's/^/ * /' >> ULTIMATE_ALL_SOURCES.java
        fi
        
        echo " */" >> ULTIMATE_ALL_SOURCES.java
        
        # æ˜¾ç¤ºæœ€ç»ˆç»Ÿè®¡
        echo ""
        echo "ðŸŽ‰ ç»ˆæžåˆå¹¶æ–‡ä»¶åˆ›å»ºå®Œæˆï¼"
        echo "ðŸ“Š æ–‡ä»¶ç»Ÿè®¡ä¿¡æ¯ï¼š"
        echo "   - æ–‡ä»¶å¤§å°: $(ls -lh ULTIMATE_ALL_SOURCES.java | awk '{print $5}')"
        echo "   - è¡Œæ•°: $(wc -l ULTIMATE_ALL_SOURCES.java | awk '{print $1}')"
        echo "   - å­—ç¬¦æ•°: $(wc -c ULTIMATE_ALL_SOURCES.java | awk '{print $1}')"
        
        # å¤åˆ¶åˆ°å·¥ä½œåŒºä»¥ä¾¿ä¸‹è½½
        cp ULTIMATE_ALL_SOURCES.java $GITHUB_WORKSPACE/
        cp JADX_ALL_SOURCES.java $GITHUB_WORKSPACE/ 2>/dev/null || true
        cp CFR_ALL_SOURCES.java $GITHUB_WORKSPACE/ 2>/dev/null || true
    
    - name: Extract Critical Information
      run: |
        cd /tmp/aar_analysis
        
        echo "================================================"
        echo "       Critical Information Extraction"
        echo "================================================"
        
        # åˆ›å»ºä¸€ä¸ªæ±‡æ€»æ–‡ä»¶
        cat > method_summary.md << 'EOF'
# Method Summary for libv2ray.aar

## Available Classes and Methods

EOF
        
        # æå–å…³é”®ç±»çš„æ‰€æœ‰å…¬å…±æ–¹æ³•
        for class_name in "libv2ray.Libv2ray" "libv2ray.CoreController" "libv2ray.CoreCallbackHandler" "go.Seq"; do
          echo -e "\n### $class_name\n" >> method_summary.md
          echo '```java' >> method_summary.md
          javap -public -cp extracted_classes "$class_name" 2>/dev/null | grep -E "public" | grep -v "class " >> method_summary.md || echo "Class not found" >> method_summary.md
          echo '```' >> method_summary.md
        done
        
        echo -e "\nðŸ“Š METHOD SUMMARY CREATED"
        cat method_summary.md
    
    - name: Search for V2Ray Specific Methods
      run: |
        cd /tmp/aar_analysis
        
        echo "================================================"
        echo "    V2Ray Specific Methods Search"
        echo "================================================"
        
        # å…³é”®è¯åˆ—è¡¨
        KEYWORDS=(
          "init" "start" "stop" "run"
          "config" "Config"
          "stats" "Stats"
          "protect" "Protect"
          "setup" "Setup"
          "prepare" "Prepare"
          "shutdown" "Shutdown"
          "version" "Version"
          "test" "Test"
          "check" "Check"
          "callback" "Callback"
          "emit" "Emit"
          "status" "Status"
          "V2" "v2"
          "ray" "Ray"
          "core" "Core"
          "controller" "Controller"
        )
        
        echo -e "\nðŸ” SEARCHING FOR KEY METHODS:\n"
        
        for keyword in "${KEYWORDS[@]}"; do
          echo "â”â”â” Searching: $keyword â”â”â”"
          
          # åœ¨ç±»æ–‡ä»¶ä¸­æœç´¢
          javap -p -cp extracted_classes $(find extracted_classes -name "*.class" | head -20 | xargs) 2>/dev/null | grep -i "$keyword" | head -5 || true
          
          # åœ¨åç¼–è¯‘ä»£ç ä¸­æœç´¢
          if [ -d "decompiled_jadx" ]; then
            grep -r "$keyword" decompiled_jadx --include="*.java" 2>/dev/null | grep -v "import" | grep -v "//" | head -3 || true
          fi
          
          echo ""
        done
    
    - name: Generate Complete Kotlin Implementation
      run: |
        cd /tmp/aar_analysis
        
        echo "================================================"
        echo "    Generating Kotlin Implementation"
        echo "================================================"
        
        # åŸºäºŽå‘çŽ°çš„æ–¹æ³•ç”Ÿæˆå®Œæ•´çš„ Kotlin å®žçŽ°
        cat > V2RayVpnService_Complete.kt << 'EOF'
package com.example.cfvpn

import android.app.NotificationChannel
import android.app.NotificationManager
import android.app.PendingIntent
import android.app.Service
import android.content.BroadcastReceiver
import android.content.Context
import android.content.Intent
import android.content.IntentFilter
import android.net.VpnService
import android.os.*
import android.util.Log
import androidx.core.app.NotificationCompat
import kotlinx.coroutines.*
import java.io.File

// Import based on AAR analysis
import go.Seq
import libv2ray.*

/**
 * V2Ray VPN Service Implementation
 * Compatible with libv2ray.aar from 2dust/AndroidLibV2rayLite
 */
class V2RayVpnService : VpnService() {
    
    companion object {
        private const val TAG = "V2RayVpnService"
        private const val NOTIFICATION_ID = 1
        private const val NOTIFICATION_CHANNEL_ID = "v2ray_vpn_channel"
    }
    
    private var mInterface: ParcelFileDescriptor? = null
    private var isRunning = false
    
    override fun onCreate() {
        super.onCreate()
        Log.d(TAG, "onCreate")
        
        try {
            // Initialize Go runtime
            Seq.setContext(applicationContext)
            Log.d(TAG, "Go runtime initialized")
            
            // Initialize V2Ray environment
            // Based on the AAR analysis, use appropriate method
            // Example: Libv2ray.initV2Env(filesDir.absolutePath)
            
        } catch (e: Exception) {
            Log.e(TAG, "Initialization failed", e)
        }
    }
    
    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {
        Log.d(TAG, "onStartCommand")
        
        if (intent?.action == "STOP_VPN") {
            stopVPN()
            return START_NOT_STICKY
        }
        
        val config = intent?.getStringExtra("config")
        if (config.isNullOrEmpty()) {
            Log.e(TAG, "No config provided")
            stopSelf()
            return START_NOT_STICKY
        }
        
        startForeground(NOTIFICATION_ID, createNotification())
        
        GlobalScope.launch(Dispatchers.IO) {
            startVPN(config)
        }
        
        return START_STICKY
    }
    
    private suspend fun startVPN(config: String) = withContext(Dispatchers.IO) {
        try {
            Log.d(TAG, "Starting VPN with config")
            
            // 1. Establish VPN tunnel
            establishVPN()
            
            // 2. Start V2Ray core
            // TODO: Call appropriate method from libv2ray
            // Based on AAR analysis, this might be:
            // - Libv2ray.startV2Ray(config)
            // - CoreController.start(config)
            // etc.
            
            isRunning = true
            Log.i(TAG, "VPN started successfully")
            
        } catch (e: Exception) {
            Log.e(TAG, "Failed to start VPN", e)
            stopSelf()
        }
    }
    
    private fun establishVPN() {
        Log.d(TAG, "Establishing VPN tunnel")
        
        val builder = Builder()
        builder.setSession("CFVPN")
        builder.setMtu(1500)
        builder.addAddress("10.0.0.2", 32)
        builder.addRoute("0.0.0.0", 0)
        builder.addDnsServer("8.8.8.8")
        builder.addDnsServer("8.8.4.4")
        
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
            builder.addDisallowedApplication(packageName)
        }
        
        mInterface?.close()
        mInterface = builder.establish()
        
        Log.d(TAG, "VPN tunnel established: ${mInterface?.fd}")
    }
    
    private fun stopVPN() {
        Log.d(TAG, "Stopping VPN")
        
        isRunning = false
        
        // TODO: Stop V2Ray core
        // Based on AAR analysis
        
        mInterface?.close()
        mInterface = null
        
        stopForeground(true)
        stopSelf()
    }
    
    private fun createNotification(): android.app.Notification {
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
            val channel = NotificationChannel(
                NOTIFICATION_CHANNEL_ID,
                "VPN Service",
                NotificationManager.IMPORTANCE_LOW
            )
            val nm = getSystemService(NotificationManager::class.java)
            nm.createNotificationChannel(channel)
        }
        
        return NotificationCompat.Builder(this, NOTIFICATION_CHANNEL_ID)
            .setContentTitle("CFVPN")
            .setContentText("VPN is running")
            .setSmallIcon(android.R.drawable.ic_dialog_info)
            .setPriority(NotificationCompat.PRIORITY_LOW)
            .setOngoing(true)
            .build()
    }
    
    override fun onDestroy() {
        super.onDestroy()
        Log.d(TAG, "onDestroy")
        stopVPN()
    }
}
EOF
        
        echo "âœ… Kotlin implementation generated"
        cat V2RayVpnService_Complete.kt
    
    - name: Create Final Report
      run: |
        cd /tmp/aar_analysis
        
        # åˆ›å»ºæœ€ç»ˆæŠ¥å‘Š
        cat > FINAL_REPORT.md << 'EOF'
        # libv2ray.aar Analysis Complete Report
        
        ## Summary
        - Analysis completed successfully
        - All classes and methods extracted
        - Multiple decompilers used for accuracy
        - ðŸ†• **ç»Ÿä¸€æºç æ–‡ä»¶å·²ç”Ÿæˆ**
        
        ## Key Files Generated
        1. **ULTIMATE_ALL_SOURCES.java** - ðŸ“ **ç»ˆæžç»Ÿä¸€æºç æ–‡ä»¶ (æŽ¨è)**
        2. JADX_ALL_SOURCES.java - JADX åç¼–è¯‘åˆå¹¶æ–‡ä»¶
        3. CFR_ALL_SOURCES.java - CFR åç¼–è¯‘åˆå¹¶æ–‡ä»¶
        4. method_summary.md - æ‰€æœ‰å…¬å…±æ–¹æ³•æ€»ç»“
        5. V2RayVpnService_Complete.kt - Kotlin å®žçŽ°æ¨¡æ¿
        
        ## ðŸŽ¯ ä½¿ç”¨å»ºè®®
        1. **ä¼˜å…ˆæŸ¥çœ‹ ULTIMATE_ALL_SOURCES.java**
        2. åœ¨æ–‡ä»¶ä¸­æœç´¢ "SECTION 1", "SECTION 2", "SECTION 3" å¿«é€Ÿå¯¼èˆª
        3. æœç´¢å…·ä½“ç±»åæˆ–æ–¹æ³•åå¿«é€Ÿå®šä½ä»£ç 
        4. æ ¹æ®åç¼–è¯‘ç»“æžœæ›´æ–° Kotlin å®žçŽ°
        
        ## Important Notes
        - æ‰€æœ‰æºç å·²åˆå¹¶åˆ°å•ä¸€æ–‡ä»¶ï¼Œä¾¿äºŽæŸ¥çœ‹å’Œåˆ†æž
        - åŒæ—¶ä¿ç•™äº†åˆ†æ•£æ–‡ä»¶ç‰ˆæœ¬ï¼Œæ»¡è¶³ä¸åŒéœ€æ±‚
        - Native æ–¹æ³•éœ€è¦ç‰¹åˆ«å…³æ³¨ JNI å®žçŽ°
        
        EOF
        
        cp FINAL_REPORT.md $GITHUB_WORKSPACE/
        cp method_summary.md $GITHUB_WORKSPACE/
        cp V2RayVpnService_Complete.kt $GITHUB_WORKSPACE/
    
    - name: Upload all artifacts
      uses: actions/upload-artifact@v4
      with:
        name: complete-aar-analysis-unified
        path: |
          FINAL_REPORT.md
          method_summary.md
          V2RayVpnService_Complete.kt
          ULTIMATE_ALL_SOURCES.java
          JADX_ALL_SOURCES.java
          CFR_ALL_SOURCES.java
          /tmp/aar_analysis/decompiled_jadx/**/*.java
          /tmp/aar_analysis/decompiled_cfr/*.java
    
    - name: Display Summary
      run: |
        echo "================================================"
        echo "           âœ… ANALYSIS COMPLETE"
        echo "================================================"
        echo ""
        echo "ðŸ“Š Results:"
        echo "  â€¢ All classes analyzed"
        echo "  â€¢ All methods documented"  
        echo "  â€¢ Source code decompiled"
        echo "  â€¢ ðŸŽ¯ Sources unified into single files"
        echo "  â€¢ Kotlin template created"
        echo ""
        echo "ðŸ“¥ Key Downloads:"
        echo "  â€¢ ðŸŒŸ ULTIMATE_ALL_SOURCES.java (ç»ˆæžåˆå¹¶æ–‡ä»¶)"
        echo "  â€¢ ðŸ“„ JADX_ALL_SOURCES.java (JADXåˆå¹¶ç‰ˆ)"
        echo "  â€¢ ðŸ“„ CFR_ALL_SOURCES.java (CFRåˆå¹¶ç‰ˆ)"
        echo "
